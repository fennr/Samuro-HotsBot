# SamuroBot for Heroes of the Storm

## Authors

 **[fennr (@fennr)](fennr.github.io/)**

## Links

На случай выхода патча ссылки для обноваления json файлов

 **[heroesdata](https://github.com/HeroesToolChest/heroes-data/tree/master/heroesdata)**
### Автоматическое обновление
* Обновить в конфиге номер текущего патча > config.yaml > patch
* Загрузить *heroesdata* и *gamestrings* запустив файл *download_gamestrings.py*
### Ссылки для ручного обновления
* В папке data взять файл __herodata*.json__, заменить содержимое **heroesdata.json**
* В папке gamestrings взять файл __gamestrings*ruru.json__, заменить содержимое **gamestrings.json**
* Файл с переводом геров основан на спаршеных билдах **[стулка](https://vk.com/@st_lk-builds-roles)**. Обновлений он не требует, При необходимости дописать нового героя в ручную.

## To Do


- [ ] Задача для Влада
    - [ ] Написать отдельную функцию get_league_by_mmr(mmr: int) -> league, division
        1. Входные данные - ММР
        2. Выходные данные - Лига и дивизион, примерные данные взять у меня
            - Функция должна быть написана с учетом легкого изменения параметров: не должно быть 30 if на каждый дивизион
            - Примерная идея: словарь или список хранит лиги и минимальный ммр для вхождения, туда append игрока, сортировка по возрастанию и ищешь какую лигу и дивизион он пересек, их возвращаешь
            - Поиск более оптимального алгоритма приветствуется
    - [ ] С написанной функцией *get_league_by_mmr* переписать функцию profile_fix, чтобы передавать в нее только игрока и ММР 
    - [ ] *По возможности* изучить написанные методы и добавить в местах правки ММР функцию, которая проверяет изменилась ли лига игрока. И соответственно если изменилась вызывать первую функцию
- [X] Добавить в таблицу сервер игрока
    - [X] Добавить вывод аватарки на любом другом сервере
- [ ] Отрефакторить profile
    - [ ] Выделить отдельные функции для всего, максимально переиспользовать код
    - [ ] Перейти везде на словарь с нормальными обращениями к объектам, убрать списки
    - [ ] Минимизировать число отдельных обращений к БД (посмотреть масс обновления записей)
- [X] Пересмотреть таблицу игроков
    - [X] Сделать *id* и *guild_id* типа *int8*
    - [X] Перейти на varchar
    - [X] Переименовать *rank* в *league*
    - [X] Переименовать *discord* в *id*
    - [X] Установить ключи *id*, *btag* для оптимизации поиска и дефолтного блока дубликатов
    - [ ] Возможно расширить профиль новыми полями или перенести их в другие таблицы
- [ ] Пересмотреть ивенты
    - [ ] Добавить сервер проведения
    - [ ] Возможно считать рейтинг игрока для каждого отдельного сервера (нужно разделение таблиц)
        - [ ] Выносим отдельно *id* *guild_id* *win* *lose*
        - [ ] Считаем отдельно *win* *lose* для каждого *guild_id*
        - [ ] Выводим в профиль исходя из того с какого *guild_id* вызывается просмотр профиля
        - [ ] Связываем с профилем по ключу *id*
- [ ] Заранее распланировать разделение игроков по таблицам в БД, нарисовать схему
    - [ ] Учесть дополнительную таблицу команд, кланлидеров
    - [ ] Учесть ивенты
    - [ ] Учесть турниры
    - [ ] Учесть достижения
- [ ] Переделать хелп по рекомендациям дискорда
- [ ] **profile.py** разделить на несколько отдельных файлов по группам
    - profile
    - events
    - отдельная библиотека функций
- [X] Начать уже покрывать все функции тестами
- [ ] Добавить тестовые токены в переменные среды, удалить из конфига
- [ ] Поправить суб таланты шапки абатура
- [ ] Добавить для класса Hero возможность принимать или строку (и искать) или сразу словарь
- [ ] Добавить инструкции по настройке PostegreSQL, по возможности автоматизировать процессы
- [ ] Отрефакторить *cogs*, посмотреть где логичнее описание команд
- [ ] Добавить блэклист в БД
- [ ] Добавить новости в БД
- [ ] Протестировать взаимодействие с БД через **sqlalchemy**
- [ ] Возможно перейти на конфиг в json или считывать его в отдельный класс
- [ ] Добавить тесты кода

## License

This project is licensed under the Apache License 2.0 - see the [LICENSE.md](LICENSE.md) file for details
