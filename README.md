# SamuroBot for Heroes of the Storm

## Authors

 **[fennr (@fennr)](fennr.github.io/)**
 
## Description

Бот обладает обширной библиотекой функций, связанных с игрой *Heroes of the Storm*;

Также присутствует несколько функций для discord-комьюнити, 
написанных специально под ряд серверов;

При необходимости можно добавлять или удалять отдельные модули из **cogs** не затрагивая остальной функционал

### GOGS

#### Игровые

* **heroes.py** — Модуль выдает основую информацию по всем героям
* **hots.py** — Все команды связанные с хотсом, помимо информации о героях

#### Сообщество 

* **profile.py** — Связка профилей в дискорде с батлнете. Основа для следующих модулей
* **event.py** — Проведение событий
* **team.py** — Объединения людей в команды/кланы
* **achievement.py** — Присвоение и вывод достижений
* **stats.py** — Вывод статистики по людям, событиям, достижениям

Данный раздел требует для работы отдельную Базу данных.

#### RU | Heroes of the Storm

* **news.py** — Создание новостей и рассписания для сообщенства *RU | Heroes of the Storm*
* **ruhots.py** — Доп функции для RUHotS: лайки и вывод Артов от художников

Модули отделены от основной кодовой базы, содержат много хардкода и специфичных моментов.
Возможно когда-нибудь я вернусь к этим функциям, в их текущем состоянии рекомендую их к удалению.

#### Технические

* **help.py** — Хелп по командам, выводит справку по каждому отдельному модулю
* **CommandErrorHandler.py** — Обработчик особых ситуаций. Вынесен отдельно т.к используется много своих обработок исключений
* **owner.py** — Ряд технических команд доступных только создателю бота (в данный момент не доработан)
* **general.py** — Базовые команды: проверка жив ли бот, приглашение бота, информация о боте

* **slash.py** — Создание команд с подсказками через слеш

Слеш команды обладают несколькими особенностями.
Именно из-за них во многих местах используется получение guild_id и author_id,
т.к эти атрибуты именуются не так, как в стандартной библиотеке дискорда.
Обычно для слеша команды пишут отдельно, но я ленив и старался писать так, чтобы они работали сразу и там и там.


## Patch Updates

Обновление осуществляется в полуавтоматическом режиме, поскольку обновление файлов в репозитории осуществляется с задержкой.

Перед обновлением проверить, что мейнтейнер **heroesdata** выложил новые файлы

На случай выхода патча ссылки для обновления json файлов: 
**[heroesdata](https://github.com/HeroesToolChest/heroes-data/tree/master/heroesdata)**
### Автоматическое обновление
* Обновить в конфиге номер текущего патча > config.yaml > patch
* Загрузить *heroesdata* и *gamestrings* запустив файл *download_gamestrings.py*
### Ссылки для ручного обновления
* В папке data взять файл __herodata*.json__, заменить содержимое **heroesdata.json**
* В папке gamestrings взять файл __gamestrings*ruru.json__, заменить содержимое **gamestrings.json**

## To Do для версии 0.5 - 1.0

- [ ] Разгрести папку utils/hots
    - [ ] Или дополнить ее и вынести туда функции из других модулей
    - [ ] Или объединить файлы перенести в utils/library
- [ ] Выделить все embed функции в отдельный файл в utils/library
- [X] Добавить тестовые токены в переменные среды, удалить из конфига
- [ ] Добавить скрипт для создания всех элементов БД
- [ ] Протестировать взаимодействие с БД через **sqlalchemy**
- [ ] Добавить тесты кода
- [ ] Добавить файлы для генерации таблиц в БД
- [ ] Перейти на использование исключений где это возможно
    - [ ] Больше пользовательских исключений
    - [ ] Отдельные обработчики внутри cog
- [ ] Добавить больше комментариев
- [ ] Переписать *create_heroes_ru_data* и все встреонные функции
- [ ] Попробовать собрать docker образ


## License

This project is licensed under the Apache License 2.0 - see the [LICENSE.md](LICENSE.md) file for details
