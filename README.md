# SamuroBot for Heroes of the Storm

## Authors

 **[fennr (@fennr)](fennr.github.io/)**

## Links

На случай выхода патча ссылки для обноваления json файлов

 **[heroesdata](https://github.com/HeroesToolChest/heroes-data/tree/master/heroesdata)**
### Автоматическое обновление
* Обновить в конфиге номер текущего патча > config.yaml > patch
* Загрузить *heroesdata* и *gamestrings* запустив файл *download_gamestrings.py*
### Ссылки для ручного обновления
* В папке data взять файл __herodata*.json__, заменить содержимое **heroesdata.json**
* В папке gamestrings взять файл __gamestrings*ruru.json__, заменить содержимое **gamestrings.json**

## To Do для версии 0.5


- [X] Перейти на свой расчет ММР, отдельный от heroesprofile
    - [X] Написать отдельную функцию get_league_by_mmr(mmr: int) -> league, division
        1. Входные данные - ММР
        2. Выходные данные - Лига и дивизион, примерные данные взять у меня
            - Функция должна быть написана с учетом легкого изменения параметров: не должно быть 30 if на каждый дивизион
            - Примерная идея: словарь или список хранит лиги и минимальный ммр для вхождения, туда append игрока, сортировка по возрастанию и ищешь какую лигу и дивизион он пересек, их возвращаешь
            - Поиск более оптимального алгоритма приветствуется
    - [X] С написанной функцией *get_league_by_mmr* переписать функцию profile_fix, чтобы передавать в нее только игрока и ММР 
    - [X] *По возможности* изучить написанные методы и добавить в местах правки ММР функцию, которая проверяет изменилась ли лига игрока. И соответственно если изменилась вызывать первую функцию
- [X] Добавить в таблицу сервер игрока
    - [X] Добавить вывод аватарки на любом другом сервере
- [X] Отрефакторить profile
    - [X] Выделить отдельные функции для всего, максимально переиспользовать код
    - [X] Перейти везде на словарь с нормальными обращениями к объектам, убрать списки
    - [X] Минимизировать число отдельных обращений к БД (посмотреть масс обновления записей)
- [X] Пересмотреть таблицу игроков
    - [X] Сделать *id* и *guild_id* типа *int8*
    - [X] Перейти на varchar
    - [X] Переименовать *rank* в *league*
    - [X] Переименовать *discord* в *id*
    - [X] Установить ключи *id*, *btag* для оптимизации поиска и дефолтного блока дубликатов
    - [X] Возможно расширить профиль новыми полями или перенести их в другие таблицы
- [X] Пересмотреть ивенты
    - [X] Добавить сервер проведения
    - [X] Возможно считать рейтинг игрока для каждого отдельного сервера (нужно разделение таблиц)
        - [X] Выносим отдельно *id* *guild_id* *win* *lose*
        - [X] Считаем отдельно *win* *lose* для каждого *guild_id*
        - [X] Выводим в профиль исходя из того с какого *guild_id* вызывается просмотр профиля
        - [X] Связываем с профилем по ключу *id*
- [X] Заранее распланировать разделение игроков по таблицам в БД, нарисовать схему
    - [X] Учесть дополнительную таблицу команд, кланлидеров
    - [X] Учесть ивенты
    - [X] Учесть турниры
    - [X] Учесть достижения
- [X] Переделать хелп по рекомендациям дискорда
- [X] **profile.py** разделить на несколько отдельных файлов по группам
    - profile
    - events
    - отдельная библиотека функций
- [X] Начать уже покрывать все функции тестами
- [X] Добавить тестовые токены в переменные среды, удалить из конфига
- [ ] Добавить для класса Hero возможность принимать или строку (и искать) или сразу словарь
- [ ] Добавить инструкции по настройке PostegreSQL, по возможности автоматизировать процессы
- [ ] Отрефакторить *cogs*, посмотреть где логичнее описание команд
- [ ] Добавить блэклист в БД
- [ ] Добавить новости в БД
- [ ] Протестировать взаимодействие с БД через **sqlalchemy**
- [ ] Возможно перейти на конфиг в json или считывать его в отдельный класс
- [ ] Добавить тесты кода
- [ ] Добавить файлы для генерации таблиц в БД
- [ ] Перейти на использование исключений где это возможно
    - [ ] Больше пользовательских исключений
    - [ ] Отдельные обработчики внутри cog
- [ ] Добавить больше комментариев
- [ ] Удалить эксперимент с веб версией
- [ ] Переписать *create_heroes_ru_data* и все встреонные функции
- [ ] Вообще вспомогательные функции выделить в отдельную папку


## License

This project is licensed under the Apache License 2.0 - see the [LICENSE.md](LICENSE.md) file for details
